# 앱 실행 및 출시

- 앱 실행하기
  - Android Studio를 실행하고 [Phone and Tablet]에서 [Empty Views Activity]를 선택해 프로젝트를 생성한다.
  - 가상 기기에서 실행하기
    - 안드로이드 가상 기기는 AVD(Android Virtual Device)라고 하며, 흔히 에뮬레이터라고 부른다.
    - Android Studio 오른쪽 위에 있는 [Device Manager]를 클릭하면 디바이스 매니저 창이 나타나는데, 이 창에는 안도르이드 개발 환경을 구축하며 자동으로 설정된 AVD 목록을 확인할 수 있다.
    - 새로 추가하는 것도 가능하며, 새로 추가할 경우 하드웨어와 시스템 이미지를 선택해야 하는데, 시스템 이미지는 하드웨어에 실행할 안드로이드 운영체제의 버전을 선택하는 것이다.
    - [Recommended] 탭에는 Play Store 같은 구글의 기본 앱치 설치된 버전이고 [x86 images] 탭에는 나머지 버전이 모두 표시된다.
    - 이 두 탭에 있는 AVD는 인텔의 하드웨어 가속 기능인 HAXM(Hardware Accelerated Execution Manager)을 사용한다.
    - 만약 HAXM을 설치할 수 없는 환경이라면 [Other images]에 있는 시스템 이미지를 사용해야 한다.
  - 제스처 내비게이션
    - AVD를 실행하면 안드로이드 휴대폰에서 흔히 보던 내비게이션 바(이전 화면으로 돌아가기, 홈으로 가기 등)가 보이지 않을 수도 있다.
    - 이 버튼이 보이지 않는 이유는 디바이스 환경 설정에서 시스템 내비게이션 설정이 제스처 네비게이션으로 설정되어 있기 때문으로, 내비게이션 버튼을 손가락 제스처로 대체하는 것이다.
    - 네비게이션 바를 표시하고 싶다면 AVD 화면 내에서[Settings 앱 실행 - System - Navigation mode]에서 설정할 수 있다.
  - 실제 스마트폰에서 실행하기
    - 앱을 개발할 때는 대부분 에뮬레이터에서 테스트할 수 있지만, 최종 배포하기 전에는 실제 기기에서 테스트해 봐야 한다.
    - 또한 에뮬레이터를 실행하기 어려운 환경이거나 성능이 까다로운 앱은 실제 기기에서 테스트하기도 한다.
    - 앱일 실제 스마트폰에서 실행하려면 먼저 컴퓨터와 연결해야한다.
    - macOS에서는 컴퓨터가 스마트폰을 자동으로 인식하지만, Windows에서는 USB 드라이버를 설치해야하며, 이는 스마트폰 제조사 홈페이지에서 설치가 가능하다.
    - 스마트폰에서 USB 디버깅을 허용해줘야 하는데, 이는 스마트폰마다 설정이 다를 수 있다.
  - 앱 실행하기
    - AVD에서 실행하든 실제 스마트폰에서 실행하든 앱을 실행하는 방법은 동일하다.
    - Android Studio 우측 상단에 초록색 우측 화살표 버튼을 누르면 앱이 실행된다.



- 앱 출시 준비

  - 배포 파일
    - 앱을 출시하려면 프로젝트의 여러 파일을 하나로 묶어서 배포해야한다.
    - 사용자가 자신의 안드로이드 스마트폰에 앱을 설치하려면 구글 Play Store나 기타 앱 마켓에서 내려받아야 한다.
    - 이때 사용자는 개발자가 등록한 배포 파일을 내려받게 된다.
    - 안드로이드 앱의 배포 파일은 APK(Andorid Appication Package)와 AAB(Adnroid App Bundle)가 있다.
    - APK는 안드로이드의 전통적인 배포 파일로, 컴파일된 코드와 리소스를 묶어서 키로 서명한 것이다.
    - AAB는 2018년 Google IO에서 발표한 새로운 안드로이드 앱 배포 파일이다.
    - AAB 파일은 Play Store에 올리면 사용자 기기에 맞게 최적화된 APK를 대신 만들어 준다.
    - 즉 사용자 기기에 내려받아 앱을 설치하는 파일은 똑같이 APK지만, 개발자가 직접 APK 파일을 만들지 않고 Play Store에 최적화된 파일을 만들어주는 것이다.
    - 이 때 앱을 내려받는 기기에 맞는 파일만 포함하므로 앱의 크기가 줄어드는 효과가 있다.
    - 즉 AAB 방식으로 등록한 앱을 내려 받는 사용자는 APK 방식과 달리 사용자 기기에 필요한 파일만 내려받게 된다.
  - 앱 서명
    - 안드로이드 배포 파일을 만들려면 키를 만들어 앱에 서명해야 한다.
    - 앱을 서명하는 방법은 크게 두 가지로 나뉘는데 하나는 서명 키를 개발자가 직접 만들어 관리하는 방법이고, 다른 하나는 Google Play에서 관리하는 방법이다.
    - 개발자가 서명 키를 직접 관리하는 방법은 출시용으로 앱을 빌드할 때 개발자가 만든 키로 앱을 서명하고 Play Store에 등록하여 사용자에게 전달한다.
    - 즉 개발자가 만든 서명 키 1개로 앱을 관리하는데, 개발자가 키를 분실하거나 도용될 때 대처할 방법이 없다.
    - 앱을 업데이트 하려면 이전 버전과 똑같은 키로 서명해야 하는데 서명할 수가 없어 업데이트를 하지 못하며, 새로운 키를 만들어 서명하면 완전히 다른 새로운 앱으로 등록된다.
    - 이러한 문제를 해결하고자 Google에서는 Play 앱 서명이라는 서비스를 만들었다.
    - 구글 Play 앱 서명 방식은 키를 2개로 구분한다.
    - 개발자가 만들고 관리하는 업로드 키와 구글 Play가 만드는 앱 서명 키이다.
    - 개발자가 키를 만들어 앱을 서명하지만 이 키는 앱을 구글 Play에 등록할 때만 사용하는 업로드 키이다.
    - 구글 Play는 업로드된 앱을 다시 자체적으로 만든 키로 서명해서 사용자에게 전달한다.
    - 구글 Play의 앱 서명 키는 구글에서 관리하며 개발자가 직접 제어할 수 없다.
    - 이처럼 키가 구분되어 있어 개발자가 키를 분실하거나 도용되더라도 앱을 서명한 키는 안전하므로 앱을 계속 업데이트 할 수 있따.
    - 개발자가 관리하는 키는 다시 만들어 Play Store에 등록하면 된다.

  - Play Store에 앱을 배포하기 전에 준비해야 할 파일은 아래와 같다.
    - AAB 파일: 완성한 앱을 서명한 배포 파일.
    - 앱 아이콘 이미지: Play Store에 표시할 앱 이미지로, 512 * 512px 크기에 1MB 미만으로 JPEG나 32bit PNG 파일을 준비해야한다.
    - 그래픽 이미지: Play Store에서 앱을 프로모션할 때 이용할 이미지로, 1024 * 500px 크기에 15MB 미만으로 JPEG나 24bit PNG 파일을 준비해야한다.
    - 휴대전화 스크린샷: 스마트폰에서 앱을 실행한 스크린샷으로, 230~3840px 크기(비율은 16:9 또는 9:16)에 1개당 8MB 미만 이미지를 2~8개 JPEG나 24비트 PNG 파일로 준비해야 한다.
    - 7/10인치 테블릿 스크린샷: 7인치나 10인치 태블릿에서 앱을 실행한 스크린샷이다.
    - 320~3840px 크기(비율은 16:9 또는 9:16)에 1개당 8MB 미만 이미지를 최대 8개 JPEG나 24비트 PNG 파일로 준비해야 한다.



- AAB 배포 파일 만들기

  - 고유한 패키지명으로 바꾸기
    - 안드로이드 앱은 개발자가 지정한 고유한 패키지명으로 식별된다.
    - 그런데 안드로이드 스튜디오에서 프로젝트를 만들 때 기본인 `com.example`로 시작하는 패키지명은 Play Store에 등록할 수 없다.
    - 따라서 출시용 앱으로 빌드하기 전에 고유한 패키지명으로 변경해야 한다.
    - 패키지명을 변경하려면 모듈 수준의 build.gradle.kts 파일을 수정해야한다.
    - Android Studio의 프로젝트 창을 보면 [Gradle Scripts] 아래 build.gradle.kts(Module:app)이라는 파일이 있는데, 여기서 app 사용자가 지정한 프로젝트명과 모듈명이다.
    - 아 파일을 열어 `applicationId` 항목을 고유한 이름으로 수정하면 된다.
    - 변경한 후에는 편집창 위쪽에 동기화 메뉴가 나타나는데, [Sync now]를 클릭하면 수정한 내용이 적용된다.

  ```groovy
  android {
      # ...
  
      defaultConfig {
          applicationId = "com.cha.firstandroidapp"
          # ...
      }
      # ...
  }
  ```

  - AAB 파일 생성 시작하기
    - [Build - Generate Signed Bundle / APK]를 선택한다/
    - 배포 파일 형식을 선택하는 창이 나오면 [Android App Bundle]을 선택한다.
  - 키 저장소와 서명 키(업로드 키) 만들기
    - 키 저장소는 일종의 인증서라고 생각하면 된다.
    - 키 저장소로 내가 만든 앱에 서명해야 앱을 출시할 수 있다.
    - 이전에 만들어 놓은 키 저장소가 있다면 [Choose existing]을 통해 사용하면 되고, 새로 만들어야 한다면 [Create new]를 통해 생성할 수 있다.
    - 키 저장소 생성 창이 열리면 경로 부분에 디렉터리 아이콘을 눌러 저장할 위치를 선택하고 이름을 입력한다.
    - 이어서 키 저장소 경로 아래 비밀번호를 입력한다.
    - 그리고 키 영역에서 alias와 비밀번호, 기타 키 정보를 입력한 OK를 클릭하면 확장자가 jks인 키 저장소 파일이 만들어진다.
  - 앱 서명하기
    - 서명키를 만든 후에 앱 서명 창으로 다시 돌아가게 되는데, 이 창에서 방금 생성한 키 저장소 비밀번호와 키 alias, 비밀번호를 입력한다.
    - 만일 [Export encrypted key]가 체크되어 있다면 해제하고 Next를 클릭한다.
    - 만약 이미 Play Store에 등록된 앱을 Play 앱 서명으로 다시 등록하려면 [Export encrypted key]를 체크하고 경로를 지정한다.
    - 그러면 서명 키로 암호화된 pepk 파일로 저장되는데, 이 파일로 기존 앱을 Play 앱 서명으로 등록할 수 있다.
  - 릴리즈용 빌드하기
    - AAB 파일을 디버그 용으로 만들 것인지 릴리즈 용으로 만들것인지를 선택한다.
    - [release]를 선택하고 Create를 클릭하면 서명된 AAB 파일로 빌드를 시작한다.
  - 빌드된 AAB 파일 확인하기
    - Android Studio가 빌드를 마치면 프로젝트 루트 디렉터리에 app/release/app-release.aab] 파일이 만들어진다.
    - 파일명에서 app은 프로젝트의 모듈명에 해당한다.



- Google Play에 앱 등록하기
  - 자신의 구글 계정을 개발자 계정으로 등록해야한다.
    - 구글의 개발자 계정으로 등록하려면 25달러의 비용이 든다(구독형이 아닌 최초 1회만 결제하면 된다).
    - [구글 플에이 콘솔](https://play.google.com/console/about/)에 접속한 후 [Play Console로 이동]을 클릭한다.
    - 개발자 계정 만들기 화면으로 이동되며, 개발자 계정을 만드는 데 필요한 정보를 입력하고 [계정 생성 및 결제]를 클릭한다.
  - Play console에서 앱 만들기
    - 앱 만들기 화면에서 각종 설정을 완료한 후 앱을 만든다.
    - 앱 이름, 언어, 유료 여부 등을 설정한다.
  - Play console에서 앱 설정하기
    - 앱을 만든 후 대시보드에서 앱을 게시하는 데 필요한 각종 정보와 설정, 파일 등을 등록할 수 있다.
    - 구글에 안내하는 절차에 따라 앱에 대한 정보를 입력한다.
  - Google Play에 앱 게시하기
    - 프로덕션 화면에서 [새 버전 만들기]를 클릭한다.
    - 서명 관련 설정을 완료화고 준비된 AAB 파일을 업로드하여 마무리한다.
    - 이후 구글에서 심사를 거쳐 Google Play에 등록된다.



